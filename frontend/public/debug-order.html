<!DOCTYPE html>
<html>

<head>
  <title>Debug Order Payload</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }

    .section {
      margin: 20px 0;
      padding: 15px;
      background: #252526;
      border-radius: 5px;
    }

    .error {
      color: #f48771;
    }

    .success {
      color: #89d185;
    }

    .warning {
      color: #dcdcaa;
    }

    pre {
      background: #1e1e1e;
      padding: 10px;
      border-radius: 3px;
      overflow-x: auto;
    }

    button {
      padding: 10px 20px;
      background: #0e639c;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }

    button:hover {
      background: #1177bb;
    }
  </style>
</head>

<body>
  <h1>üîç Order Payload Debugger</h1>

  <div class="section">
    <h2>Instructions:</h2>
    <ol>
      <li>Open browser console (F12)</li>
      <li>Go to checkout page</li>
      <li>Look for log: <code class="warning">üì¶ Order Payload (JSON):</code></li>
      <li>Copy the JSON object</li>
      <li>Paste it in the textarea below</li>
      <li>Click "Validate"</li>
    </ol>
  </div>

  <div class="section">
    <h2>Paste Order Payload JSON:</h2>
    <textarea id="payload"
      style="width: 100%; height: 300px; font-family: monospace; background: #1e1e1e; color: #d4d4d4; border: 1px solid #3c3c3c; padding: 10px;"></textarea>
    <br><br>
    <button onclick="validatePayload()">Validate Payload</button>
  </div>

  <div id="results" class="section" style="display: none;">
    <h2>Validation Results:</h2>
    <div id="output"></div>
  </div>

  <script>
    function validatePayload() {
      const textarea = document.getElementById('payload');
      const results = document.getElementById('results');
      const output = document.getElementById('output');

      try {
        const payload = JSON.parse(textarea.value);
        let html = '';
        let errors = [];
        let warnings = [];

        // Validate items
        if (!payload.items || !Array.isArray(payload.items)) {
          errors.push('items must be an array');
        } else if (payload.items.length === 0) {
          errors.push('items array must have at least 1 item');
        } else {
          payload.items.forEach((item, index) => {
            // Check product ID
            const productId = item.product || item.productId;
            if (!productId) {
              errors.push(`items[${index}]: missing product or productId field`);
            } else if (typeof productId !== 'string') {
              errors.push(`items[${index}].product: must be a string, got ${typeof productId}`);
            } else if (!/^[0-9a-fA-F]{24}$/.test(productId)) {
              errors.push(`items[${index}].product: "${productId}" is not a valid MongoDB ObjectId (must be 24 hex characters)`);
            }

            // Check other fields
            if (!item.name) errors.push(`items[${index}]: missing name`);
            if (item.price === undefined || item.price === null) errors.push(`items[${index}]: missing price`);
            if (typeof item.price !== 'number') errors.push(`items[${index}].price: must be a number, got ${typeof item.price}`);
            if (item.price < 0) errors.push(`items[${index}].price: must be >= 0`);
            if (!item.quantity) errors.push(`items[${index}]: missing quantity`);
            if (!Number.isInteger(item.quantity)) errors.push(`items[${index}].quantity: must be an integer`);
            if (item.quantity < 1) errors.push(`items[${index}].quantity: must be >= 1`);
            if (!item.size) errors.push(`items[${index}]: missing size`);
            if (!item.color) errors.push(`items[${index}]: missing color`);
          });
        }

        // Validate shippingAddress
        if (!payload.shippingAddress) {
          errors.push('shippingAddress is required');
        } else {
          const required = ['fullName', 'address', 'city', 'state', 'zipCode', 'phone'];
          required.forEach(field => {
            if (!payload.shippingAddress[field]) {
              errors.push(`shippingAddress.${field} is required`);
            }
          });
        }

        // Validate paymentMethod
        if (!payload.paymentMethod) {
          errors.push('paymentMethod is required');
        } else if (!['COD', 'CARD', 'cod', 'card'].includes(payload.paymentMethod)) {
          errors.push(`paymentMethod must be "COD" or "CARD", got "${payload.paymentMethod}"`);
        }

        // Validate pricing
        if (payload.subtotal === undefined) errors.push('subtotal is required');
        if (typeof payload.subtotal !== 'number') errors.push(`subtotal must be a number, got ${typeof payload.subtotal}`);
        if (payload.total === undefined) errors.push('total is required');
        if (typeof payload.total !== 'number') errors.push(`total must be a number, got ${typeof payload.total}`);

        // Display results
        if (errors.length === 0) {
          html += '<div class="success">‚úÖ Payload is valid!</div>';
          html += '<pre>' + JSON.stringify(payload, null, 2) + '</pre>';
        } else {
          html += '<div class="error">‚ùå Validation Errors:</div>';
          html += '<ul>';
          errors.forEach(err => {
            html += `<li class="error">${err}</li>`;
          });
          html += '</ul>';
        }

        output.innerHTML = html;
        results.style.display = 'block';

      } catch (e) {
        output.innerHTML = `<div class="error">‚ùå Invalid JSON: ${e.message}</div>`;
        results.style.display = 'block';
      }
    }
  </script>
</body>

</html>